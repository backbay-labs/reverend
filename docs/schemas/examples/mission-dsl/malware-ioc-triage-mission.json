{
  "schema_version": 1,
  "mission_id": "triage.malware_ioc.v1",
  "mission_kind": "triage",
  "description": "Deterministic malware triage mission that emits IOC bundles and evidence-linked behavior maps.",
  "inputs": [
    {
      "name": "sample_set",
      "type": "array",
      "description": "Pinned malware sample metadata rows with provenance.",
      "required": true
    },
    {
      "name": "analysis_artifacts",
      "type": "array",
      "description": "Static and dynamic analysis artifacts indexed by sample id.",
      "required": true
    }
  ],
  "outputs": [
    {
      "name": "ioc_bundle",
      "description": "Deterministic IOC bundle output.",
      "source": {
        "kind": "stage_output",
        "stage_id": "emit_ioc_bundle",
        "output": "ioc_bundle"
      }
    },
    {
      "name": "behavior_map",
      "description": "Evidence-linked ATT&CK behavior map output.",
      "source": {
        "kind": "stage_output",
        "stage_id": "emit_behavior_map",
        "output": "behavior_map"
      }
    }
  ],
  "policies": {
    "determinism": {
      "execution_order": "linear",
      "stage_selector": "explicit_ids_only",
      "allow_randomness": false
    },
    "conflict_resolution": {
      "source_priority_order": [
        "human",
        "static_analysis",
        "ml_model",
        "heuristic"
      ],
      "confidence_margin": 0.05,
      "tie_breaker": "stage_order_then_id"
    },
    "approval": {
      "human_review_on_apply": true,
      "auto_apply_threshold": 1.0
    },
    "retry_defaults": {
      "max_attempts": 2,
      "backoff_strategy": "fixed",
      "initial_delay_ms": 250,
      "jitter": "none"
    }
  },
  "stages": [
    {
      "id": "normalize_artifacts",
      "order": 1,
      "kind": "normalize",
      "description": "Normalize and sort sample/artifact inputs for deterministic processing.",
      "depends_on": [],
      "inputs": [
        {
          "name": "sample_set",
          "source": {
            "kind": "mission_input",
            "input": "sample_set"
          }
        },
        {
          "name": "analysis_artifacts",
          "source": {
            "kind": "mission_input",
            "input": "analysis_artifacts"
          }
        }
      ],
      "outputs": [
        {
          "name": "normalized_rows",
          "type": "array",
          "description": "Stable sorted rows for extraction and behavior mapping."
        }
      ]
    },
    {
      "id": "extract_iocs",
      "order": 2,
      "kind": "analyze",
      "description": "Extract IOC candidates from normalized rows with provenance links.",
      "depends_on": [
        "normalize_artifacts"
      ],
      "inputs": [
        {
          "name": "normalized_rows",
          "source": {
            "kind": "stage_output",
            "stage_id": "normalize_artifacts",
            "output": "normalized_rows"
          }
        }
      ],
      "outputs": [
        {
          "name": "ioc_rows",
          "type": "array",
          "description": "Sample-scoped IOC rows and source evidence references."
        }
      ]
    },
    {
      "id": "emit_ioc_bundle",
      "order": 3,
      "kind": "report",
      "description": "Render deterministic IOC bundle payload.",
      "depends_on": [
        "extract_iocs"
      ],
      "inputs": [
        {
          "name": "ioc_rows",
          "source": {
            "kind": "stage_output",
            "stage_id": "extract_iocs",
            "output": "ioc_rows"
          }
        }
      ],
      "outputs": [
        {
          "name": "ioc_bundle",
          "type": "object",
          "description": "Machine-readable IOC bundle by sample id."
        }
      ]
    },
    {
      "id": "emit_behavior_map",
      "order": 4,
      "kind": "report",
      "description": "Render evidence-linked ATT&CK behavior map payload.",
      "depends_on": [
        "extract_iocs"
      ],
      "inputs": [
        {
          "name": "ioc_rows",
          "source": {
            "kind": "stage_output",
            "stage_id": "extract_iocs",
            "output": "ioc_rows"
          }
        }
      ],
      "outputs": [
        {
          "name": "behavior_map",
          "type": "object",
          "description": "Behavior map rows with explicit evidence references."
        }
      ]
    }
  ]
}
